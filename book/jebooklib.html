<!DOCTYPE html>
<html lang="en">

<head>
    <title>jeBook Library</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Library that contains eBooks">
    <meta name="author" content="bestGaming132">
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../default.css">
    <link rel="stylesheet" href="../scroll.css">
</head>

<body align="center">
    <h2>Library</h2>
    <p>Click on a book to select it.<br>Currently selected: <span id="cursel">Default</span></p>
    <button onclick="location.href='jebook.html'">Read Book <span id="cursel2">Default</span></button>
    <table id="t">
        <tbody id="tb">
        </tbody>
    </table>
</body>
<script>
    //useful functions
    function log(str) {
        console.log(str);
    }

    function elm(id) {
        return document.getElementById(id);
    }

    //start
    function p(txt, tit) {
        let p = document.createElement("p")
        p.innerHTML = txt
        if (tit) p.classList.add("t")
        return p
    }
    function img(url) {
        let img = document.createElement("img")
        img.src = url
        return img
    }
    var sw
    if (screen.width <= 350) sw = 1
    else if (screen.width <= 500) sw = 2
    else if (screen.width <= 700) sw = 3
    else sw = 4
    function genLib(input) {
        var tb = elm("tb")
        var tr = document.createElement("tr")
        for (i = 1; i < input.list.length + 1; i++) {
            let td = document.createElement("td")
            let div = document.createElement("div")
            div.appendChild(p(input.list[i - 1].title, 1))
            if (input.list[i - 1].img != "none") div.appendChild(img(input.list[i - 1].img))
            div.appendChild(p(input.list[i - 1].desc))
            div.classList.add("nobar")
            div.id = i - 1
            div.onclick = function () {
                elm("cursel").innerHTML = input.list[this.id].title
                elm("cursel2").innerHTML = input.list[this.id].title
                localStorage.setItem("selBook", JSON.stringify({ "title": input.list[this.id].title, "filen": input.boloc + input.list[this.id].filen }))
            }
            td.appendChild(div)
            tr.appendChild(td)

            if (i % sw == 0 || i == input.list.length) {
                tb.appendChild(tr)
                tr = document.createElement("tr")
            }
        }
    }
    libjson = {
        "boloc": "https://bestgaming1320.github.io/book/jebooks/",
        "list": [
            {
                "title": "Default",
                "desc": "This is the default book",
                "img": "./jebooks/default.png",
                "filen": "default.json"
            },
            {
                "title": "Example",
                "desc": "This is the example book wich can be found in the docs",
                "img": "./jebooks/example.png",
                "filen": "example.json"
            },
            {
                "title": "Cold Gussa",
                "desc": "Short story and cover generated by <a href='https://www.plot-generator.org.uk/'>plot-generator.org.uk</a> with the help of <a href='https://www.fantasynamegenerators.com'>fantasynamesgenerators.com</a>",
                "img": "./jebooks/coldgussa.png",
                "filen": "coldgussa.json"
            }
        ]
    }
    let ce = location.search.slice(1)
    let json
    if (ce) {
        json = JSON.parse(decodeURIComponent(ce))
    } else json = libjson
    genLib(json)
    elm("cursel").innerHTML = elm("cursel2").innerHTML = JSON.parse(localStorage.getItem("selBook")).title

</script>
<style>
    table {
        margin: 0 auto
    }

    div {
        width: 20vw;
        min-width: 160px;
        height: 20vh;
        min-height: 300px;
        border: 2px solid #999;
        overflow-y: scroll
    }

        div:hover {
            background: #222;
        }

    .t {
        font-size: 22px;
        font-weight: 700
    }

    img {
        width: 70%;
        max-height: 190px;
        object-fit: scale-down
    }

    p {
        font-size: 16px;
        overflow-wrap:break-word
    }
</style>
</html>
